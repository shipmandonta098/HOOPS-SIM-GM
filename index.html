<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Hoops Sim Starter</title>
  <style>
    :root {
      --bg: #0b0f17;
      --panel: #111827;
      --panel2: #0f172a;
      --text: #e5e7eb;
      --muted: #9ca3af;
      --line: #243041;
      --accent: #60a5fa;
      --good: #34d399;
      --bad: #f87171;
      --warn: #fbbf24;
      --radius: 14px;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      background: linear-gradient(180deg, #070a10, #0b0f17 35%, #070a10);
      color: var(--text);
    }
    a { color: inherit; text-decoration: none; }
    button {
      border: 1px solid var(--line);
      background: var(--panel2);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 10px;
      cursor: pointer;
    }
    button:hover { border-color: #3a4a63; }
    button.primary {
      border-color: rgba(96,165,250,.45);
      background: rgba(96,165,250,.12);
    }
    button.danger {
      border-color: rgba(248,113,113,.45);
      background: rgba(248,113,113,.10);
    }
    .app {
      display: grid;
      grid-template-columns: 260px 1fr;
      min-height: 100vh;
    }
    .sidebar {
      border-right: 1px solid var(--line);
      background: rgba(17,24,39,.65);
      backdrop-filter: blur(10px);
      padding: 18px 14px;
      position: sticky;
      top: 0;
      height: 100vh;
      overflow: auto;
    }
    .brand {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 10px 14px;
      border-bottom: 1px solid var(--line);
      margin-bottom: 12px;
    }
    .brand .logo {
      width: 36px; height: 36px;
      border-radius: 12px;
      background: radial-gradient(circle at 30% 30%, rgba(96,165,250,.8), rgba(96,165,250,.1));
      border: 1px solid rgba(96,165,250,.35);
      box-shadow: var(--shadow);
    }
    .brand .title { font-weight: 800; letter-spacing: .3px; }
    .brand .sub { font-size: 12px; color: var(--muted); margin-top: 2px; }

    .nav {
      display: grid;
      gap: 6px;
      margin-top: 12px;
    }
    .nav a {
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid transparent;
      color: var(--muted);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .nav a.active {
      color: var(--text);
      border-color: rgba(96,165,250,.35);
      background: rgba(96,165,250,.10);
    }
    .nav a:hover { border-color: #2b3a52; color: var(--text); }

    .main {
      padding: 18px 18px 30px;
      max-width: 1200px;
    }
    .topbar {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 14px;
    }
    .topbar .left {
      display: flex;
      gap: 10px;
      align-items: center;
      flex-wrap: wrap;
    }
    .pill {
      border: 1px solid var(--line);
      background: rgba(17,24,39,.55);
      padding: 10px 12px;
      border-radius: 999px;
      color: var(--muted);
      display: flex;
      gap: 10px;
      align-items: center;
    }
    .pill b { color: var(--text); }
    .grid {
      display: grid;
      gap: 14px;
      grid-template-columns: repeat(12, 1fr);
    }
    .card {
      grid-column: span 12;
      border: 1px solid var(--line);
      border-radius: var(--radius);
      background: rgba(17,24,39,.65);
      box-shadow: var(--shadow);
      overflow: hidden;
    }
    .card .hd {
      padding: 14px 14px 10px;
      border-bottom: 1px solid var(--line);
      display: flex;
      justify-content: space-between;
      gap: 10px;
      align-items: baseline;
    }
    .card .hd h2 {
      margin: 0;
      font-size: 16px;
      letter-spacing: .2px;
    }
    .card .hd .hint {
      color: var(--muted);
      font-size: 12px;
    }
    .card .bd { padding: 14px; }

    .kpis {
      display: grid;
      gap: 12px;
      grid-template-columns: repeat(12, 1fr);
    }
    .kpi {
      grid-column: span 6;
      border: 1px solid var(--line);
      border-radius: 14px;
      padding: 12px;
      background: rgba(15,23,42,.6);
    }
    .kpi .label { color: var(--muted); font-size: 12px; }
    .kpi .value { font-size: 22px; font-weight: 800; margin-top: 6px; }
    .kpi .delta { margin-top: 4px; font-size: 12px; color: var(--muted); }

    table { width: 100%; border-collapse: collapse; }
    th, td {
      text-align: left;
      padding: 10px 8px;
      border-bottom: 1px solid rgba(36,48,65,.8);
      font-size: 14px;
    }
    th { color: var(--muted); font-weight: 600; font-size: 12px; text-transform: uppercase; letter-spacing: .8px; }
    tr:hover td { background: rgba(96,165,250,.06); }

    .tag {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 8px;
      border-radius: 999px;
      font-size: 12px;
      border: 1px solid rgba(156,163,175,.25);
      color: var(--muted);
      background: rgba(15,23,42,.45);
    }
    .tag.good { border-color: rgba(52,211,153,.35); color: #a7f3d0; background: rgba(52,211,153,.08); }
    .tag.bad  { border-color: rgba(248,113,113,.35); color: #fecaca; background: rgba(248,113,113,.08); }

    .log {
      display: grid;
      gap: 8px;
      font-size: 13px;
      color: var(--muted);
    }
    .log .item {
      padding: 10px 12px;
      border: 1px solid rgba(36,48,65,.9);
      border-radius: 12px;
      background: rgba(15,23,42,.55);
    }

    .two { grid-column: span 12; }
    @media (min-width: 900px) {
      .two { grid-column: span 6; }
      .kpi { grid-column: span 3; }
    }

    .row-actions { display: flex; gap: 8px; flex-wrap: wrap; }
    .muted { color: var(--muted); }
    .click { color: var(--accent); cursor: pointer; }
    .click:hover { text-decoration: underline; }

    /* Mobile sidebar toggle */
    .mobileToggle { display: none; }
    @media (max-width: 820px) {
      .app { grid-template-columns: 1fr; }
      .sidebar { position: fixed; left: 0; top: 0; width: 290px; transform: translateX(-110%); transition: .2s; z-index: 5; }
      .sidebar.open { transform: translateX(0); }
      .mobileToggle { display: inline-flex; }
      .main { padding-top: 68px; }
      .topbar { position: fixed; top: 0; left: 0; right: 0; padding: 12px 12px; background: rgba(11,15,23,.88); backdrop-filter: blur(12px); border-bottom: 1px solid var(--line); z-index: 4; }
    }
  </style>
</head>
<body>
  <div class="app">
    <aside class="sidebar" id="sidebar">
      <div class="brand">
        <div class="logo"></div>
        <div>
          <div class="title">Hoops Sim</div>
          <div class="sub" id="subTitle">offline prototype</div>
        </div>
      </div>

      <div class="nav" id="nav">
        <a href="#dashboard" data-route="dashboard" class="active"><span>üè† Dashboard</span><span>‚Ä∫</span></a>
        <a href="#league" data-route="league"><span>üåç League</span><span>‚Ä∫</span></a>
        <a href="#teams" data-route="teams"><span>üèüÔ∏è Teams</span><span>‚Ä∫</span></a>
        <a href="#players" data-route="players"><span>üßë‚Äçü¶± Players</span><span>‚Ä∫</span></a>
      </div>

      <div style="margin-top:14px; padding:12px; border:1px dashed rgba(156,163,175,.25); border-radius:14px; color:var(--muted); font-size:12px; line-height:1.5;">
        This is a prototype. It‚Äôs not ‚ÄúBasketball GM,‚Äù it‚Äôs the baby version that grows into it.
        Start small: data ‚Üí UI ‚Üí sim.
      </div>
    </aside>

    <main class="main">
      <div class="topbar">
        <div class="left">
          <button class="mobileToggle" id="toggleSidebar">‚ò∞ Menu</button>
          <div class="pill">üìÖ Day <b id="dayLabel">1</b> <span class="muted">/</span> <span id="seasonLabel">Season 2026</span></div>
          <div class="pill">üíæ Save: <b id="saveStatus">Loaded</b></div>
        </div>
        <div class="row-actions">
          <button id="sim1" class="primary">Sim 1 Day</button>
          <button id="sim7">Sim 1 Week</button>
          <button id="newLeague" class="danger">New League</button>
        </div>
      </div>

      <div id="view"></div>
    </main>
  </div>

  <script>
    /**********************
     * 1) Data + Storage
     **********************/
    const STORAGE_KEY = "hoops_sim_league_v1";

    function randInt(min, max) {
      return Math.floor(Math.random() * (max - min + 1)) + min;
    }
    function clamp(n, min, max) {
      return Math.max(min, Math.min(max, n));
    }
    function uuid() {
      return crypto.randomUUID ? crypto.randomUUID() : String(Date.now()) + "-" + randInt(1000, 9999);
    }

    function defaultLeague() {
      // Keep it tiny. Complexity is a tax.
      const teams = [
        { id: uuid(), name: "New York Knights", abbrev: "NYK", wins: 0, losses: 0, cash: 50_000_000 },
        { id: uuid(), name: "Chicago Comets",  abbrev: "CHI", wins: 0, losses: 0, cash: 50_000_000 },
        { id: uuid(), name: "LA Starlight",    abbrev: "LAS", wins: 0, losses: 0, cash: 50_000_000 },
        { id: uuid(), name: "Miami Tide",      abbrev: "MIA", wins: 0, losses: 0, cash: 50_000_000 },
      ];

      // Players: rating roughly 30‚Äì90
      const names = [
        ["Jalen", "Cross"], ["Malik", "Hughes"], ["Theo", "Navarro"], ["Darius", "Cole"],
        ["Andre", "Vaughn"], ["Zion", "Parker"], ["Marcus", "Reed"], ["Kyrie", "Santos"],
        ["Noah", "Okafor"], ["Devin", "Price"], ["Evan", "Knight"], ["Jordan", "Kim"],
      ];

      const positions = ["PG", "SG", "SF", "PF", "C"];

      const players = names.map((n, i) => {
        const team = teams[i % teams.length];
        const ovr = randInt(50, 85);
        const pot = clamp(ovr + randInt(-5, 12), 45, 95);
        const age = randInt(19, 34);
        const salary = randInt(2, 30) * 1_000_000;
        return {
          id: uuid(),
          firstName: n[0],
          lastName: n[1],
          pos: positions[i % positions.length],
          age,
          teamId: team.id,
          ovr,
          pot,
          salary,
          mood: randInt(40, 90), // 0-100
          stamina: randInt(70, 100),
          stats: { gp: 0, pts: 0, reb: 0, ast: 0 }
        };
      });

      return {
        meta: {
          name: "My League",
          season: 2026,
          day: 1,
          phase: "REGULAR_SEASON", // later: PRESEASON, PLAYOFFS, OFFSEASON
        },
        teams,
        players,
        log: ["League created."]
      };
    }

    function loadLeague() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return defaultLeague();
        return JSON.parse(raw);
      } catch (e) {
        console.warn("Load failed, resetting league:", e);
        return defaultLeague();
      }
    }

    function saveLeague() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(state.league));
      setSaveStatus("Saved");
      // tiny status reset
      clearTimeout(saveLeague._t);
      saveLeague._t = setTimeout(() => setSaveStatus("Loaded"), 900);
    }

    /**********************
     * 2) State
     **********************/
    const state = {
      route: "dashboard",
      league: loadLeague(),
      selectedTeamId: null,
      selectedPlayerId: null,
    };

    function setSaveStatus(text) {
      document.getElementById("saveStatus").textContent = text;
    }

    /**********************
     * 3) Sim Logic (tiny)
     **********************/
    function teamPower(teamId) {
      // Simple: average OVR of roster (top 3 weighted)
      const roster = state.league.players.filter(p => p.teamId === teamId);
      const sorted = [...roster].sort((a,b) => b.ovr - a.ovr);
      const top = sorted.slice(0, 3);
      const rest = sorted.slice(3);
      const topAvg = top.length ? top.reduce((s,p)=>s+p.ovr,0)/top.length : 0;
      const restAvg = rest.length ? rest.reduce((s,p)=>s+p.ovr,0)/rest.length : topAvg;
      return (topAvg * 0.65) + (restAvg * 0.35);
    }

    function simulateOneGame(teamA, teamB) {
      const aPow = teamPower(teamA.id) + randInt(-6, 6);
      const bPow = teamPower(teamB.id) + randInt(-6, 6);

      // Base points loosely related to power
      const aPts = clamp(Math.round(95 + (aPow - 60) * 1.2 + randInt(-10, 10)), 70, 145);
      const bPts = clamp(Math.round(95 + (bPow - 60) * 1.2 + randInt(-10, 10)), 70, 145);

      let winner = teamA, loser = teamB, wPts = aPts, lPts = bPts;
      if (bPts > aPts) { winner = teamB; loser = teamA; wPts = bPts; lPts = aPts; }
      if (bPts === aPts) { // no ties, we are not doing soccer today
        if (Math.random() < 0.5) { winner = teamB; loser = teamA; wPts = bPts + 1; lPts = aPts; }
        else { wPts = aPts + 1; lPts = bPts; }
      }

      winner.wins += 1;
      loser.losses += 1;

      // Players: give top guys some stats
      distributeStats(winner.id, true);
      distributeStats(loser.id, false);

      return `${winner.abbrev} ${wPts} ‚Äî ${loser.abbrev} ${lPts}`;
    }

    function distributeStats(teamId, won) {
      const roster = state.league.players
        .filter(p => p.teamId === teamId)
        .sort((a,b) => b.ovr - a.ovr);

      const top = roster.slice(0, 3);
      const others = roster.slice(3);

      // Update GP and box score-ish numbers
      const teamPts = randInt(90, 130);
      let remaining = teamPts;

      function addLine(p, shareMin, shareMax) {
        const pts = clamp(Math.round(teamPts * (randInt(shareMin, shareMax)/100)), 6, 45);
        remaining -= pts;

        p.stats.gp += 1;
        p.stats.pts += pts;
        p.stats.reb += randInt(1, 12);
        p.stats.ast += randInt(0, 11);

        // Mood: win helps, loss hurts (tiny)
        p.mood = clamp(p.mood + (won ? randInt(0,2) : -randInt(0,2)), 0, 100);
        // Stamina: playing costs a bit, recovers in simDay()
        p.stamina = clamp(p.stamina - randInt(2, 6), 0, 100);
      }

      top.forEach(p => addLine(p, 18, 30));
      others.slice(0, 2).forEach(p => addLine(p, 10, 18));
    }

    function simDay() {
      const { meta, teams } = state.league;

      // stamina recovery
      state.league.players.forEach(p => {
        p.stamina = clamp(p.stamina + randInt(1, 4), 0, 100);
      });

      // schedule: just pick 2 random matchups daily
      const shuffled = [...teams].sort(() => Math.random() - 0.5);
      const games = [];
      for (let i = 0; i + 1 < shuffled.length; i += 2) {
        games.push(simulateOneGame(shuffled[i], shuffled[i+1]));
      }

      meta.day += 1;
      if (meta.day > 112) { // fake season length
        meta.day = 1;
        meta.season += 1;
        teams.forEach(t => { t.wins = 0; t.losses = 0; });
        state.league.log.unshift(`Season advanced to ${meta.season}. Records reset.`);
      }

      state.league.log.unshift(`Day simmed: ${games.join(" | ")}`);
      if (state.league.log.length > 25) state.league.log.length = 25;

      saveLeague();
      render();
    }

    /**********************
     * 4) Views
     **********************/
    function money(n) {
      return "$" + Math.round(n).toLocaleString();
    }
    function playerName(p) {
      return `${p.firstName} ${p.lastName}`;
    }
    function teamById(id) {
      return state.league.teams.find(t => t.id === id);
    }

    function viewDashboard() {
      const { meta, teams, players, log } = state.league;

      const totalPayroll = players.reduce((s,p)=>s+p.salary,0);
      const bestTeam = [...teams].sort((a,b) => (b.wins-b.losses) - (a.wins-a.losses))[0];
      const topPlayer = [...players].sort((a,b) => b.ovr - a.ovr)[0];

      return `
        <div class="grid">
          <div class="card">
            <div class="hd">
              <h2>League Snapshot</h2>
              <div class="hint">The ‚Äústart simple‚Äù era.</div>
            </div>
            <div class="bd">
              <div class="kpis">
                <div class="kpi">
                  <div class="label">League</div>
                  <div class="value">${meta.name}</div>
                  <div class="delta">Phase: ${meta.phase}</div>
                </div>
                <div class="kpi">
                  <div class="label">Teams</div>
                  <div class="value">${teams.length}</div>
                  <div class="delta">Tiny league for a tiny prototype</div>
                </div>
                <div class="kpi">
                  <div class="label">Players</div>
                  <div class="value">${players.length}</div>
                  <div class="delta">Enough to test rosters</div>
                </div>
                <div class="kpi">
                  <div class="label">Total Payroll</div>
                  <div class="value">${money(totalPayroll)}</div>
                  <div class="delta">A very fake economy</div>
                </div>
              </div>
            </div>
          </div>

          <div class="card two">
            <div class="hd">
              <h2>Standings</h2>
              <div class="hint">Click a team on the Teams page for details.</div>
            </div>
            <div class="bd">
              ${standingsTable()}
              <div class="muted" style="margin-top:10px;">
                Best team right now: <b>${bestTeam.name}</b>
              </div>
            </div>
          </div>

          <div class="card two">
            <div class="hd">
              <h2>Top Player</h2>
              <div class="hint">Because we all worship at the altar of OVR.</div>
            </div>
            <div class="bd">
              <div style="font-size:18px; font-weight:800;">${playerName(topPlayer)} <span class="tag">${topPlayer.pos}</span></div>
              <div class="muted" style="margin-top:6px;">
                Team: <b>${teamById(topPlayer.teamId).name}</b><br/>
                OVR: <b>${topPlayer.ovr}</b> ¬∑ POT: <b>${topPlayer.pot}</b> ¬∑ Age: <b>${topPlayer.age}</b><br/>
                Salary: <b>${money(topPlayer.salary)}</b> ¬∑ Mood: <b>${topPlayer.mood}</b> ¬∑ Stamina: <b>${topPlayer.stamina}</b>
              </div>
              <div class="muted" style="margin-top:10px;">
                Stats (total): ${topPlayer.stats.gp} GP ¬∑ ${topPlayer.stats.pts} PTS ¬∑ ${topPlayer.stats.reb} REB ¬∑ ${topPlayer.stats.ast} AST
              </div>
            </div>
          </div>

          <div class="card">
            <div class="hd">
              <h2>League Log</h2>
              <div class="hint">Most recent on top</div>
            </div>
            <div class="bd">
              <div class="log">
                ${log.map(x => `<div class="item">üìù ${escapeHtml(x)}</div>`).join("") || `<div class="item">No events yet.</div>`}
              </div>
            </div>
          </div>
        </div>
      `;
    }

    function standingsTable() {
      const teams = [...state.league.teams].sort((a,b) => b.wins - a.wins || a.losses - b.losses);
      return `
        <table>
          <thead>
            <tr><th>Team</th><th>W</th><th>L</th><th>Power</th></tr>
          </thead>
          <tbody>
            ${teams.map(t => `
              <tr>
                <td><span class="click" data-team="${t.id}">${escapeHtml(t.name)}</span> <span class="tag">${t.abbrev}</span></td>
                <td>${t.wins}</td>
                <td>${t.losses}</td>
                <td>${teamPower(t.id).toFixed(1)}</td>
              </tr>
            `).join("")}
          </tbody>
        </table>
      `;
    }

    function viewLeague() {
      const { meta } = state.league;
      return `
        <div class="grid">
          <div class="card">
            <div class="hd">
              <h2>League Settings</h2>
              <div class="hint">Editable settings come later (after we don‚Äôt crash).</div>
            </div>
            <div class="bd">
              <div class="muted" style="line-height:1.7;">
                <b>Name:</b> ${escapeHtml(meta.name)}<br/>
                <b>Season:</b> ${meta.season}<br/>
                <b>Day:</b> ${meta.day}<br/>
                <b>Phase:</b> ${meta.phase}<br/><br/>
                Roadmap idea: Draft ‚Üí Contracts ‚Üí Trades ‚Üí Free Agency ‚Üí Playoffs.
              </div>
            </div>
          </div>
        </div>
      `;
    }

    function viewTeams() {
      const teams = [...state.league.teams].sort((a,b)=>a.name.localeCompare(b.name));
      return `
        <div class="grid">
          <div class="card">
            <div class="hd">
              <h2>Teams</h2>
              <div class="hint">Click a team name to see roster</div>
            </div>
            <div class="bd">
              <table>
                <thead>
                  <tr><th>Team</th><th>Record</th><th>Payroll</th><th>Cash</th></tr>
                </thead>
                <tbody>
                  ${teams.map(t => {
                    const payroll = state.league.players.filter(p=>p.teamId===t.id).reduce((s,p)=>s+p.salary,0);
                    return `
                      <tr>
                        <td><span class="click" data-team="${t.id}">${escapeHtml(t.name)}</span> <span class="tag">${t.abbrev}</span></td>
                        <td>${t.wins}-${t.losses}</td>
                        <td>${money(payroll)}</td>
                        <td>${money(t.cash)}</td>
                      </tr>
                    `;
                  }).join("")}
                </tbody>
              </table>
            </div>
          </div>

          ${state.selectedTeamId ? teamDetailCard(state.selectedTeamId) : `
            <div class="card">
              <div class="hd"><h2>Team Detail</h2><div class="hint">Select a team above</div></div>
              <div class="bd"><span class="muted">No team selected.</span></div>
            </div>
          `}
        </div>
      `;
    }

    function teamDetailCard(teamId) {
      const t = teamById(teamId);
      if (!t) return "";
      const roster = state.league.players.filter(p=>p.teamId===teamId).sort((a,b)=>b.ovr-a.ovr);
      const payroll = roster.reduce((s,p)=>s+p.salary,0);

      return `
        <div class="card">
          <div class="hd">
            <h2>${escapeHtml(t.name)} Roster</h2>
            <div class="hint">Power: ${teamPower(teamId).toFixed(1)} ¬∑ Payroll: ${money(payroll)}</div>
          </div>
          <div class="bd">
            <table>
              <thead>
                <tr><th>Player</th><th>Pos</th><th>Age</th><th>OVR</th><th>POT</th><th>Salary</th><th>Mood</th><th>Stam</th></tr>
              </thead>
              <tbody>
                ${roster.map(p => `
                  <tr>
                    <td><span class="click" data-player="${p.id}">${escapeHtml(playerName(p))}</span></td>
                    <td>${p.pos}</td>
                    <td>${p.age}</td>
                    <td>${p.ovr}</td>
                    <td>${p.pot}</td>
                    <td>${money(p.salary)}</td>
                    <td><span class="tag ${p.mood >= 60 ? "good" : "bad"}">${p.mood}</span></td>
                    <td>${p.stamina}</td>
                  </tr>
                `).join("")}
              </tbody>
            </table>
          </div>
        </div>
      `;
    }

    function viewPlayers() {
      const players = [...state.league.players].sort((a,b)=>b.ovr-a.ovr);
      return `
        <div class="grid">
          <div class="card">
            <div class="hd">
              <h2>Players</h2>
              <div class="hint">Click a player for detail</div>
            </div>
            <div class="bd">
              <table>
                <thead>
                  <tr><th>Player</th><th>Team</th><th>Pos</th><th>Age</th><th>OVR</th><th>POT</th><th>Salary</th><th>GP</th><th>PTS</th></tr>
                </thead>
                <tbody>
                  ${players.map(p => {
                    const t = teamById(p.teamId);
                    return `
                      <tr>
                        <td><span class="click" data-player="${p.id}">${escapeHtml(playerName(p))}</span></td>
                        <td>${escapeHtml(t.name)} <span class="tag">${t.abbrev}</span></td>
                        <td>${p.pos}</td>
                        <td>${p.age}</td>
                        <td>${p.ovr}</td>
                        <td>${p.pot}</td>
                        <td>${money(p.salary)}</td>
                        <td>${p.stats.gp}</td>
                        <td>${p.stats.pts}</td>
                      </tr>
                    `;
                  }).join("")}
                </tbody>
              </table>
            </div>
          </div>

          ${state.selectedPlayerId ? playerDetailCard(state.selectedPlayerId) : `
            <div class="card">
              <div class="hd"><h2>Player Detail</h2><div class="hint">Select a player above</div></div>
              <div class="bd"><span class="muted">No player selected.</span></div>
            </div>
          `}
        </div>
      `;
    }

    function playerDetailCard(playerId) {
      const p = state.league.players.find(x => x.id === playerId);
      if (!p) return "";
      const t = teamById(p.teamId);
      return `
        <div class="card">
          <div class="hd">
            <h2>${escapeHtml(playerName(p))} <span class="tag">${p.pos}</span></h2>
            <div class="hint">${escapeHtml(t.name)} ¬∑ Salary ${money(p.salary)}</div>
          </div>
          <div class="bd">
            <div class="kpis">
              <div class="kpi"><div class="label">OVR</div><div class="value">${p.ovr}</div><div class="delta">Overall rating</div></div>
              <div class="kpi"><div class="label">POT</div><div class="value">${p.pot}</div><div class="delta">Potential</div></div>
              <div class="kpi"><div class="label">Mood</div><div class="value">${p.mood}</div><div class="delta">0‚Äì100</div></div>
              <div class="kpi"><div class="label">Stamina</div><div class="value">${p.stamina}</div><div class="delta">0‚Äì100</div></div>
            </div>

            <div style="margin-top:14px; line-height:1.7;" class="muted">
              Age: <b>${p.age}</b><br/>
              Games: <b>${p.stats.gp}</b><br/>
              Totals: <b>${p.stats.pts}</b> PTS ¬∑ <b>${p.stats.reb}</b> REB ¬∑ <b>${p.stats.ast}</b> AST<br/>
              (Later you‚Äôll want per-game stats + advanced stats.)
            </div>
          </div>
        </div>
      `;
    }

    /**********************
     * 5) Rendering + Router
     **********************/
    function escapeHtml(str) {
      return String(str).replace(/[&<>"']/g, s => ({
        "&":"&amp;", "<":"&lt;", ">":"&gt;", '"':"&quot;", "'":"&#039;"
      }[s]));
    }

    function setRoute(route) {
      state.route = route;
      // update nav highlighting
      document.querySelectorAll("#nav a").forEach(a => {
        a.classList.toggle("active", a.dataset.route === route);
      });
      render();
    }

    function render() {
      const { meta } = state.league;
      document.getElementById("dayLabel").textContent = meta.day;
      document.getElementById("seasonLabel").textContent = `Season ${meta.season}`;
      document.getElementById("subTitle").textContent = `${meta.name.toLowerCase()} ¬∑ v0.1`;

      const view = document.getElementById("view");
      if (state.route === "dashboard") view.innerHTML = viewDashboard();
      else if (state.route === "league") view.innerHTML = viewLeague();
      else if (state.route === "teams") view.innerHTML = viewTeams();
      else if (state.route === "players") view.innerHTML = viewPlayers();
      else view.innerHTML = `<div class="card"><div class="bd">Unknown route.</div></div>`;

      // wire click handlers inside rendered content
      view.querySelectorAll("[data-team]").forEach(el => {
        el.addEventListener("click", () => {
          state.selectedTeamId = el.dataset.team;
          state.route = "teams";
          setRoute("teams");
        });
      });
      view.querySelectorAll("[data-player]").forEach(el => {
        el.addEventListener("click", () => {
          state.selectedPlayerId = el.dataset.player;
          state.route = "players";
          setRoute("players");
        });
      });
    }

    /**********************
     * 6) UI Events
     **********************/
    document.getElementById("nav").addEventListener("click", (e) => {
      const a = e.target.closest("a[data-route]");
      if (!a) return;
      e.preventDefault();
      setRoute(a.dataset.route);
      // close sidebar on mobile
      document.getElementById("sidebar").classList.remove("open");
    });

    document.getElementById("sim1").addEventListener("click", simDay);
    document.getElementById("sim7").addEventListener("click", () => { for (let i=0;i<7;i++) simDay(); });

    document.getElementById("newLeague").addEventListener("click", () => {
      // blunt on purpose: prototype life
      if (!confirm("Reset league? This will wipe the saved league in this browser.")) return;
      state.league = defaultLeague();
      state.selectedTeamId = null;
      state.selectedPlayerId = null;
      saveLeague();
      render();
    });

    document.getElementById("toggleSidebar").addEventListener("click", () => {
      document.getElementById("sidebar").classList.toggle("open");
    });

    // Hash routing for deep links
    window.addEventListener("hashchange", () => {
      const route = (location.hash || "#dashboard").replace("#","").trim();
      const known = ["dashboard","league","teams","players"];
      setRoute(known.includes(route) ? route : "dashboard");
    });

    // initial route
    (() => {
      const route = (location.hash || "#dashboard").replace("#","").trim();
      const known = ["dashboard","league","teams","players"];
      setRoute(known.includes(route) ? route : "dashboard");
    })();
  </script>
</body>
</html>
